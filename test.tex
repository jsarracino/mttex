\documentclass{article}

\usepackage[magicref]{mttex}

\newcommand{\newtmetavar}{\newmetavar{\tfontsym}{\tcolor}{t}}
\newcommand{\newsmetavar}{\newmetavar{\sfontsym}{\scolor}{s}}

\newtmetavar{x}
\newtmetavar{e}
\newtmetavar*{alpha}{\tfontsym{\alpha}}
\newtmetavar{v}
\newtmetavar*{ty}{\tfontsym{\tau}}

\newcommand{\newsmetavars}{\newmetavars{\sfont}{\scolor}{s}}
\newcommand{\newsmetavarsS}{\newmetavarsS{\sfontsym}{\scolor}{s}}
\newsmetavars{x, e, v}
% TODO Star convention is difficult over lists
%\newsmetavars*{x/x, e/e, v/v}
\newsmetavarsS{ty/\sigma, alpha/\alpha}

\newcommand{\stcolor}{\mathcolor{orange}}
\newcommand{\stfont}[1]{\stcolor{\mathbf{#1}}}
\newcommand{\stfontsym}{\stfont}

\newcommand{\newstmetavars}{\newmetavars{\stfont}{\stcolor}{st}}
\newcommand{\newstmetavarsS}{\newmetavarsS{\stfontsym}{\stcolor}{st}}
\newstmetavarsS{x/x, v/v, e/e, world/W, alpha/\alpha}

\newcommand{\trelV}{\lr{\tfontsym}{V}}
\newcommand{\srelE}{\lr{\sfont}{E}}

\newcommand{\newttypes}{\newtypes{\tfontsym}{\tfont}{t}{ty}}
\newcommand{\newtexprs}{\newexprs{\tfontsym}{\tfont}{te}{}}
\newttypes{fun,polyfun,forall,exist,mu,bool,unit,void,pair}
\newtexprs{let,fun,polyfun,app,papp,abstr,inst,pack,unpack,fold,unfold,if,true,false,unit,pair}

\newcommand{\tpfunty}{\tpolyfunty}

\newcommand{\sfune}{\fune{\sfontsym}{\sfont}}
\newcommand{\spolyfune}{\polyfune{\sfontsym}{\sfont}}
\newcommand{\sabstre}{\abstre{\sfontsym}{\sfont}}
\newcommand{\sinste}{\inste{\sfontsym}{\sfont}}
\newcommand{\sappe}{\appe{\sfontsym}{\sfont}}
\newcommand{\spappe}{\pappe{\sfontsym}{\sfont}}

\newcommand{\sexistty}{\existty{\sfontsym}{\sfont}}

\newcommand{\sife}{\ife{\sfontsym}{\sfont}}
\newcommand{\spacke}{\packe{\sfontsym}{\sfont}}
\newcommand{\sunpacke}{\unpacke{\sfontsym}{\sfont}}
\newcommand{\slete}{\lete{\sfontsym}{\sfont}}
\newcommand{\sfolde}{\folde{\sfontsym}{\sfont}}
\newcommand{\sunfolde}{\unfolde{\sfontsym}{\sfont}}
\newcommand{\sunite}{\unite{\sfontsym}{\sfont}}
\newcommand{\struee}{\truee{\sfontsym}{\sfont}}
\newcommand{\sfalsee}{\falsee{\sfontsym}{\sfont}}
\newcommand{\spaire}{\paire{\sfontsym}{\sfont}}

\newcommand{\txdubpr}{\txpr[2]}

\newcommand{\sttfont}[1]{\mathit{#1}\!\!}
\newmetavarsS{\mathit}{}{stt}{world/W}

\begin{document}
\tableofcontents
\listoftodos
\begin{mathpar}
  \metavar{\tfont{x}}{\tcolor{1}}{}{\tprime}{1}

  \metavar{\tfont{x}}{\tcolor{1}}{}{\tprime}{4}

  \txmetavar{}{}{0}

  \txmetavar{}{}{1}

  \tx

  \tx^1

  \tx^1_1


  %should cause an error
  %\txin{1}_1

  \txpr_1

  \tx'_1

  \tx'^1_1

  % should look worse than
  \tx\tfont{'}^1_1
  \txmetavar{1}{1}{1}

  \tx_1

  \tx^{+}

  \txpr

  \txdubpr

  \txpr[5]

  \txone

  \txonepr

  \txtwo

  \txtwopr

  \te

  \tvone

  \temetavar{}{}{0}

  \trelV{\tty}

  \srelE{\stypr}

  \lrV{\tfont}{\tty}

  \tfont{\Gamma}

  \tfontsym{\Gamma}

  \tfunty{\ttyone}{\ttytwo}

  \tpfunty{\talpha}{\ttyone}{\ttytwo}

  \tforallty{\talpha}{\tty}

  \texistty{\talpha}{\tty}

  \tmuty{\talpha}{\tty}

  \tunitty

  \tvoidty

  \tboolty

  \tpairty{\ttyone}{\ttytwo}

  \tefun{\tx}{\tty}{\teone}

  \tetrue

  \tefalse

  \sfune{\sx}{\sty}{\seone}

  \spolyfune{\salpha}{\sx}{\sty}{\sepr}

  \sabstre{\salpha}{\sty}

  \sinste{\se}{\sty}

  \sappe{\seone}{\setwo}

  \spappe{\seone}{\stypr}{\setwopr}

  \sife{\sv}{\seone}{\setwo}

  \spacke{\styone}{\se}{\sexistty{\salpha}{\stytwo}}

  \sunpacke{\salpha}{\sx}{\svpr}{\seone}

  \telet{\tx}{\te}{\teone}

  \slete{\sx}{\se}{\seone}

  \sfolde{\tmuty{\salpha}{\styone}}{\sty}

  \sunfolde{\seone}

  \sunite

  \struee

  \sfalsee

  \spaire{\seone}{\svtwopr}

  \stx

  \stalphaonepr

  \stxpr[100]
  \stxonepr[5]

  \ctxtyjudg{\tfont}{\tfont{\ectx}}{\tfont{\Gamma}}{\tty}{\tfont{\Gamma}}{\ttypr}

  \ciueqvjudg{\tfont{\Gamma}}{\te}{\tepr}{\tty}

  \ctxeqvjudg{\tfont{\Gamma}}{\te}{\tepr}{\tty}

  \rho

  \mapat{\rho}{\talpha}

  \maponeat{\rho}{\talpha}

  \maptwoat{\rho}{\talpha}

  \maprelat{\rho}{\talpha}

  \mapext{\rho}{\talpha}{\tty}

  \te \bnfdef \tx \bnfalt \tefun \tx \tty \te \bnfalt \teapp \te \tepr

  \sttworldin{1}
  W_1
  \metavar{\mathit{W}}{1}{}{}{0}
  \metavar{\mathit{W}}{\stcolor{1}}{}{}{0}

  \metavar{\stcolor{W}\!}{\stcolor{1}}{}{}{0}
  \stcolor{\mathit{W}}_{\stcolor{1}}
  \mathit{\stcolor{W}\!}_{\stcolor{1}}
  \mathit{W}_{\stcolor{1}}

  \stworldto{1}
  \sttworldto{1}
  W^1
  \mathit{W}^1

  \sttworld\!._2
  \metavar{\mathit{W}}{}{}{}{0}._2
  \metavar{W}{}{}{}{0}._2
  \metavar{\stcolor{W}\!}{}{}{}{0}._2
  W._2

\end{mathpar}

%{
%  \newcommand{\meow}{meow}
%
%}
%\meow

\begin{proof}
  Meow
\end{proof}

\begin{proof}[invalid]
  Bark
\end{proof}

\todo{Finish proof}

\subsubsection{Meow}
Meow

\section{Meow}
\label{sec:meow}

\begin{lemma}[Foo] \label{lem:foo} \end{lemma}
\begin{lemma} \label{lem:anon} \end{lemma}

Should be ``Foo'': \nameref{lem:foo}

Should be ``'': \nameref{lem:anon}

Should be ``Foo'' without a hyperlink: \nameref*{lem:foo}

\fullref{lem:foo} produces ``Lemma 1.1 (Foo)''.

\fullref{lem:anon} produces ``Lemma 1.2''

\fullref[Bar]{lem:anon} produces ``Lemma 1.2 (Bar)''

\fullref[]{lem:foo} produces ``Lemma 1.1''

\fullref*{Lemma}{lem:foo} produces ``Lemma 1.1 (Foo)''.

\fullref*{Thing}{lem:foo} produces ``Thing 1.1 (Foo)''.

\fullref*[]{Thing}{lem:foo} produces ``Thing 1.1''.


\end{document}
